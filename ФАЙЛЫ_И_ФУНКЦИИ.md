# Перечень файлов, функций, методов и классов

## Структура проекта

**Серверная часть:** `course_work/server/`  
**Клиентская часть:** `course_work/client/`

---

## 1. СЕРВЕРНАЯ ЧАСТЬ

### 1.1. server.h / server.cpp - Ядро сервера

**Класс Server** - Многопоточный TCP-сервер для обработки клиентских запросов

**Методы:**
- `Server(int port, const std::string& usersFile, const std::string& vaultDir)` - Инициализация сервера с портом и путями к файлам
- `~Server()` - Деструктор, вызывает stop()
- `initialize()` - Создание директорий, файлов, сокета и привязка к порту
- `start()` - Основной цикл приёма подключений клиентов
- `stop()` - Закрытие серверного сокета
- `getUserVaultPath(const std::string& username)` - Получение пути к файлу хранилища пользователя
- `createUserVault()` - Создание зашифрованного файла хранилища для нового пользователя
- `readUserVault()` - Чтение зашифрованного хранилища с диска
- `updateUserVault()` - Обновление/сохранение зашифрованного хранилища на диск
- `handleRegister()` - Обработка запроса регистрации, возврат seed-слов и vaultSalt
- `handleLogin()` - Аутентификация пользователя и возврат зашифрованных данных хранилища
- `handleChangePassword()` - Изменение пароля с сохранением данных хранилища
- `handleRecoverPassword()` - Восстановление пароля с использованием seed-фразы
- `handleGetVault()` - Получение зашифрованного хранилища с проверкой пароля
- `handleGetVaultWithSeedPhrase()` - Получение хранилища через seed-фразу вместо пароля
- `handleUpdateVault()` - Обновление данных хранилища на сервере
- `processRequest()` - Маршрутизация запросов к соответствующим обработчикам
- `handleClient()` - Управление соединением с отдельным клиентом

### 1.2. server_main.cpp - Точка входа сервера

**Функции:**
- `main(int argc, char* argv[])` - Точка входа, инициализация сервера с опциональным портом, установка обработчиков сигналов (SIGINT, SIGTERM)
- `signalHandler()` - Корректная обработка сигналов завершения

### 1.3. hashTableUrers.h / hashTableUrers.cpp - Хеш-таблица пользователей

**Класс HashTableUsers** - Хеш-таблица для хранения данных пользователей

**Методы:**
- `HashTableUsers(int cap)` - Конструктор с ёмкостью (по умолчанию 101)
- `insert()` - Добавление/обновление пользователя с логином, хешем пароля, солью, хешем seed-фразы, солью хранилища
- `deleteKey()` - Пометка пользователя как удалённого
- `rehash()` - Увеличение ёмкости таблицы вдвое при заполнении 75%, использование простых чисел
- `hashFunction()` - FNV-1a хеширование для поиска имени пользователя
- `loadFromFile()` - Загрузка пользователей из JSON-файла
- `saveToFile()` - Сохранение пользователей в JSON-файл
- `searchLogin()` - Проверка существования имени пользователя
- `getHashPassword()` - Возврат пары хеш пароля и соли
- `getSeedPhraseHash()` - Возврат SHA512 хеша seed-слов
- `getVaultSalt()` - Возврат соли хранилища для деривации ключа
- `switchUsersData()` - Обновление пароля и seed-фразы при смене пароля/восстановлении
- `items()` - Возврат всех неудалённых пользователей в виде вектора кортежей

### 1.4. userHashTable.h / userHashTable.cpp - Хеш-таблица записей паролей

**Класс UserHashTable** - Хеш-таблица для хранения паролей пользователя

**Методы:**
- `UserHashTable(int cap)` - Конструктор (по умолчанию 101)
- `insert()` - Добавление/обновление записи пароля (сервис, логин, пароль, URL, заметка)
- `rehash()` - Изменение размера таблицы при заполнении 75%
- `hashFunction()` - Хеширование на основе пары логин+сервис
- `loadFromFile()` - Загрузка записей из JSON
- `saveToFile()` - Сохранение записей в JSON
- `toJson()` - Преобразование таблицы в JSON-массив
- `fromJson()` - Загрузка таблицы из JSON-массива

**Функции шифрования:**
- `encrypt_aes_gcm()` - Шифрование AES-256-GCM со случайным nonce
- `decrypt_aes_gcm()` - Расшифровка AES-256-GCM

### 1.5. log_in.h / log_in.cpp - Функции входа

**Функции:**
- `existUser()` - Проверка существования пользователя в хеш-таблице
- `checkPasswordUser()` - Проверка пароля с использованием Argon2id и сохранённой соли
- `checkPhrase()` - Проверка seed-фразы путём сравнения SHA512 хешей
- `switchDataUsers()` - Изменение пароля, генерация новых seed-слов, возврат вектора seed

### 1.6. register.h / register.cpp - Функция регистрации

**Функции:**
- `loginExist()` - Регистрация нового пользователя если не существует, генерация соли, хеширование пароля, создание seed-слов

### 1.7. common_utils.h / common_utils.cpp - Вспомогательные функции

**Криптография:**
- `generateSaltRaw()` - Генерация случайной соли из /dev/urandom
- `generate128bitLibsodium()` - Генерация 128-битных случайных данных через libsodium
- `hashPasswordArgon2id()` - Хеширование пароля с Argon2id с использованием соли
- `hashSHA512()` - Вычисление SHA512 хеша строки

**Кодирование:**
- `toHex()` - Преобразование вектора байтов в шестнадцатеричную строку
- `hexToBytes()` - Преобразование hex-строки в вектор байтов
- `hexStringToVector()` - Альтернативное преобразование hex в байты
- `split132bitsTo11bitChunks()` - Разделение 132 битов на 12 11-битных фрагментов для мнемоники

**Seed-фразы:**
- `genIndexSeedWord()` - Генерация 12 индексов seed-слов из 128-битных случайных данных

**Пароли:**
- `generate_password()` - Создание случайного пароля с настраиваемыми наборами символов
- `validatePassword()` - Проверка минимальной длины (8), требование заглавных, строчных букв, цифры, спецсимвола
- `validateUsername()` - Проверка длины 3-30 символов, разрешение букв, цифр, точки, дефиса, подчёркивания
- `evaluatePasswordStrength()` - Оценка пароля от 0 до 100 на основе длины и разнообразия символов
- `getPasswordStrengthDescription()` - Возврат описания от оценки стойкости
- `estimateTimeToCrack()` - Вычисление времени брутфорса на основе энтропии
- `isWeakPassword()` - Проверка по словарю rockyou_1000k.txt или списку частых паролей

### 1.8. json.hpp - Библиотека nlohmann/json

**Внешняя библиотека** - JSON парсер и сериализатор для C++

---

## 2. КЛИЕНТСКАЯ ЧАСТЬ

### 2.1. client.h / client.cpp - Ядро клиента

**Класс Client** - Клиент для взаимодействия с сервером по TCP

**Методы:**
- `Client(const std::string& host, int port)` - Конструктор подключения к серверу
- `~Client()` - Деструктор с очисткой хранилища
- `sendRequest()` - Отправка JSON-запроса на сервер через сокет, получение ответа
- `deriveVaultKey()` - Использование Argon2id с солью хранилища для деривации AES-ключа из кодового слова
- `decryptAndLoadVault()` - Расшифровка hex-данных хранилища и загрузка в UserHashTable
- `encryptVault()` - Шифрование хранилища и возврат hex-строки
- `validateCodeWordWithVault()` - Проверка кодового слова попыткой расшифровки
- `validateCodeWord()` - Проверка кодового слова длиной 3-30 символов

**Управление пользователями:**
- `checkUserExists()` - Запрос к серверу на существование пользователя
- `registerUser(user, pass)` - Регистрация нового пользователя (устаревший метод)
- `registerUser(user, pass, seedWords)` - Регистрация с выводом seed-слов
- `registerUser(user, pass, codeWord, seedWords)` - Регистрация с шифрованием кодовым словом
- `login(user, pass, codeWord)` - Аутентификация и расшифровка хранилища с кодовым словом
- `changePassword(seedPhrase, newPassword, codeWord)` - Изменение пароля с сохранением хранилища
- `recoverPassword(user, seedPhrase, newPassword)` - Восстановление аккаунта (3 перегрузки)
- `logout()` - Очистка сессии и синхронизация хранилища

**Операции с хранилищем:**
- `addEntry()` - Добавление записи пароля с временной меткой
- `updateEntry()` - Обновление только пароля
- `updateEntryFull()` - Обновление пароля, URL, заметки
- `deleteEntry()` - Удаление записи
- `displayAllEntries()` - Отображение всех записей
- `syncToServer()` - Загрузка зашифрованного хранилища на сервер
- `syncFromServer()` - Скачивание зашифрованного хранилища с сервера
- `getVaultEntries()` - Возврат хранилища в формате JSON

### 2.2. client_main.cpp - CLI-приложение

**Функции:**
- `main()` - Терминальный интерфейс с меню для регистрации, входа, управления паролями
- `showMainMenu()` - Отображение опций главного меню
- `showUserMenu()` - Отображение меню для авторизованного пользователя
- `clearInput()` - Очистка буфера ввода
- `evaluatePasswordUI()` - CLI оценка стойкости пароля
- `getYesNoChoice()` - Чтение ответа y/n
- `getValidatedNewPassword()` - Запрос нового пароля с валидацией
- `performPasswordRecovery()` - Выполнение процесса восстановления
- `performLoginWithAttempts()` - Вход с 3 попытками и опцией восстановления

### 2.3. gui_main.cpp - Точка входа GUI

**Функции:**
- `main(int argc, char *argv[])` - Инициализация Qt, libsodium, создание MainWindow

### 2.4. mainwindow.h / mainwindow.cpp - Графический интерфейс Qt

**Класс MainWindow (QMainWindow)** - Главное окно GUI-приложения

**Методы:**
- `MainWindow(QWidget *parent)` - Конструктор создания всех UI-страниц
- `~MainWindow()` - Деструктор

**Настройка UI:**
- `setupUI()` - Инициализация стилей, виджета стека, всех страниц
- `createMainMenuPage()` - Главное меню с кнопками Регистрация/Вход/Восстановление/Оценка/Выход
- `createRegisterPage()` - Форма регистрации
- `createLoginPage()` - Форма входа со счётчиком попыток (3)
- `createPasswordEvalPage()` - Инструмент оценки стойкости пароля
- `createRecoveryPage()` - Восстановление пароля с seed-фразой
- `createUserMenuPage()` - Меню авторизованного пользователя со списком/детальным видом записей
- `createAddEntryPage()` - Форма добавления/редактирования записи пароля

**Слоты (навигация по меню):**
- `onRegisterClicked()` - Переход на страницу регистрации
- `onLoginClicked()` - Переход на страницу входа
- `onPasswordEvalClicked()` - Переход на страницу оценки пароля
- `onRecoverPasswordClicked()` - Переход на страницу восстановления
- `onRegisterSubmitClicked()` - Отправка регистрации
- `onRegisterBackClicked()` - Возврат в главное меню
- `onLoginSubmitClicked()` - Отправка входа
- `onLoginBackClicked()` - Возврат в главное меню
- `onLoginRecoverClicked()` - Отображение опции восстановления после неудачного входа
- `onEvaluateSubmitClicked()` - Оценка стойкости пароля
- `onEvaluateBackClicked()` - Возврат в главное меню
- `onRecoverySubmitClicked()` - Отправка восстановления пароля
- `onRecoveryBackClicked()` - Возврат в главное меню

**Слоты (операции пользователя):**
- `onViewEntriesClicked()` - Отображение списка записей хранилища
- `onAddEntryClicked()` - Отображение страницы добавления записи
- `onLogoutClicked()` - Выход пользователя
- `onShowPasswordClicked()` - Отображение пароля выбранной записи
- `onCopyPasswordClicked()` - Копирование пароля в буфер обмена
- `onEditEntryClicked()` - Открытие записи в режиме редактирования
- `onDeleteEntryClicked()` - Удаление выбранной записи
- `onSearchTextChanged()` - Фильтрация записей по тексту поиска
- `onAddEntryPageSubmitClicked()` - Сохранение новой/отредактированной записи
- `onAddEntryPageCancelClicked()` - Отмена редактирования записи
- `onGeneratePasswordClicked()` - Генерация случайного пароля
- `onCheckStrengthClicked()` - Оценка стойкости пароля

**Вспомогательные методы:**
- `showMainMenu()` - Отображение страницы главного меню
- `showUserMenu()` - Отображение меню пользователя после входа
- `performLogin()` - Обработка процесса входа с обратной связью UI
- `attemptLogin()` - Одна попытка входа
- `updateEntriesList()` - Обновление отображения записей хранилища
- `showEntryDetails()` - Отображение деталей выбранной записи
- `generateCustomPassword()` - Создание пароля с пользовательскими опциями

### 2.5. Общие файлы клиента

**hashTableUrers.h / hashTableUrers.cpp** - Идентичный серверному класс HashTableUsers для клиентской части

**userHashTable.h / userHashTable.cpp** - Идентичный серверному класс UserHashTable и функции AES-GCM шифрования

**log_in.h / log_in.cpp** - Идентичные серверным функции проверки входа

**register.h / register.cpp** - Идентичная серверной функция регистрации

**common_utils.h / common_utils.cpp** - Все криптографические и вспомогательные функции, дублированные в клиенте

**json.hpp** - Библиотека nlohmann/json для работы с JSON

---

## 3. КЛЮЧЕВЫЕ ТЕХНОЛОГИИ

### 3.1. Криптография
- **Хеширование паролей:** Argon2id с солью
- **Шифрование хранилища:** AES-256-GCM
- **Деривация ключей:** Argon2id с солью хранилища из кодового слова
- **Seed-фразы:** 12-словная мнемоника (стиль BIP39)
- **Хеширование seed-фраз:** SHA-512

### 3.2. Структуры данных
- **Хеш-таблицы:** Линейное пробирование для разрешения коллизий
- **Динамическое увеличение:** Автоматический rehash при 75% заполнении
- **Простые числа:** Использование простых размеров таблиц для лучшего распределения

### 3.3. Сериализация
- **Формат:** JSON для всех постоянных данных
- **Библиотека:** nlohmann/json
- **Кодирование:** Hex для бинарных данных (соли, зашифрованные данные)

### 3.4. Сеть
- **Протокол:** TCP через POSIX sockets
- **Формат сообщений:** JSON
- **Архитектура:** Клиент-сервер с многопоточным сервером

### 3.5. Интерфейсы
- **CLI:** Терминальный интерфейс (client_main.cpp)
- **GUI:** Qt-based графический интерфейс (gui_main.cpp, MainWindow)
- **Двойная безопасность:** Пароль + кодовое слово для доступа к хранилищу

### 3.6. Безопасность
- **Отсутствие plaintext хранения:** Все пароли и данные зашифрованы
- **Двухфакторная защита:** Пароль (аутентификация) + кодовое слово (расшифровка)
- **Восстановление:** 12-словная seed-фраза для восстановления доступа
- **Оценка стойкости:** Проверка по словарю, энтропия, оценка времени взлома
